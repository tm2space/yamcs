syntax = "proto2";

package yamcs.protobuf.booking;

option java_package = "org.yamcs.protobuf";
option java_outer_classname = "BookingServiceProto";
option java_multiple_files = true;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

import "yamcs/api/annotations.proto";

service BookingApi {

  // Get all ground station providers
  rpc GetProviders(google.protobuf.Empty) returns (GetProvidersResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/providers"
    };
  }

  // Get all bookings
  rpc GetBookings(google.protobuf.Empty) returns (GetBookingsResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/bookings"
    };
  }

  // Create a new booking
  rpc CreateBooking(CreateBookingRequest) returns (BookingInfo) {
    option (yamcs.api.route) = {
      post: "/api/booking/bookings"
      body: "*"
    };
  }

  // Get pending bookings for approval
  rpc GetPendingBookings(google.protobuf.Empty) returns (GetBookingsResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/bookings/pending"
    };
  }

  // Approve a booking
  rpc ApproveBooking(ApprovalRequest) returns (BookingInfo) {
    option (yamcs.api.route) = {
      post: "/api/booking/bookings/{id}/approve"
      body: "*"
    };
  }

  // Reject a booking
  rpc RejectBooking(ApprovalRequest) returns (BookingInfo) {
    option (yamcs.api.route) = {
      post: "/api/booking/bookings/{id}/reject"
      body: "*"
    };
  }

  // Get enum values
  rpc GetEnumValues(google.protobuf.Empty) returns (GetEnumValuesResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/enums"
    };
  }
}

// Messages
message GetProvidersResponse {
  repeated ProviderInfo providers = 1;
}

message GetBookingsResponse {
  repeated BookingInfo bookings = 1;
}

message ProviderInfo {
  optional int32 id = 1;
  optional string name = 2;
  optional string type = 3;
  optional string contactEmail = 4;
  optional string contactPhone = 5;
  optional string apiEndpoint = 6;
  optional bool isActive = 7;
  optional google.protobuf.Timestamp createdAt = 8;
  optional google.protobuf.Timestamp updatedAt = 9;
}

message BookingInfo {
  optional int32 id = 1;
  optional string provider = 2;
  optional string satelliteId = 3;
  optional google.protobuf.Timestamp startTime = 4;
  optional google.protobuf.Timestamp endTime = 5;
  optional int32 durationMinutes = 6;
  optional string passType = 7;
  optional string purpose = 8;
  optional string ruleType = 9;
  optional int32 frequencyDays = 10;
  optional string status = 11;
  optional string gsStatus = 12;
  optional string requestedBy = 13;
  optional string approvedBy = 14;
  optional google.protobuf.Timestamp approvedAt = 15;
  optional string rejectionReason = 16;
  optional string notes = 17;
  optional google.protobuf.Timestamp createdAt = 18;
  optional google.protobuf.Timestamp updatedAt = 19;
}

message CreateBookingRequest {
  optional string provider = 1;
  optional string satelliteId = 2;
  optional google.protobuf.Timestamp startTime = 3;
  optional int32 durationMinutes = 4;
  optional string passType = 5;
  optional string purpose = 6;
  optional string ruleType = 7;
  optional int32 frequencyDays = 8;
  optional string notes = 9;
}

message ApprovalRequest {
  optional int32 id = 1;
  optional string comments = 2;
}

message GetEnumValuesResponse {
  repeated string providerTypes = 1;
  repeated string ruleTypes = 2;
  repeated string statusTypes = 3;
  repeated string passTypes = 4;
  repeated string purposeTypes = 5;
  repeated string gsStatusTypes = 6;
}