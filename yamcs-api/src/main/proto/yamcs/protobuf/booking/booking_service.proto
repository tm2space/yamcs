syntax = "proto2";

package yamcs.protobuf.booking;

option java_package = "org.yamcs.protobuf";
option java_outer_classname = "BookingServiceProto";
option java_multiple_files = true;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

import "yamcs/api/annotations.proto";

service BookingApi {

  // Get all ground station providers
  rpc GetProviders(google.protobuf.Empty) returns (GetProvidersResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/providers"
    };
  }

  // Get all bookings
  rpc GetBookings(google.protobuf.Empty) returns (GetBookingsResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/bookings"
    };
  }

  // Create a new booking
  rpc CreateBooking(CreateBookingRequest) returns (BookingInfo) {
    option (yamcs.api.route) = {
      post: "/api/booking/bookings"
      body: "*"
    };
  }

  // Get pending bookings for approval
  rpc GetPendingBookings(google.protobuf.Empty) returns (GetBookingsResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/bookings/pending"
    };
  }

  // Approve a booking
  rpc ApproveBooking(ApprovalRequest) returns (BookingInfo) {
    option (yamcs.api.route) = {
      post: "/api/booking/bookings/{id}/approve"
      body: "*"
    };
  }

  // Reject a booking
  rpc RejectBooking(ApprovalRequest) returns (BookingInfo) {
    option (yamcs.api.route) = {
      post: "/api/booking/bookings/{id}/reject"
      body: "*"
    };
  }

  // Get enum values
  rpc GetEnumValues(google.protobuf.Empty) returns (GetEnumValuesResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/enums"
    };
  }

  // Get satellites from a provider
  rpc GetProviderSatellites(GetProviderDataRequest) returns (GetSatellitesResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/provider/{provider}/satellites"
    };
  }

  // Get ground stations from a provider
  rpc GetProviderGroundStations(GetProviderDataRequest) returns (GetGroundStationsResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/provider/{provider}/groundstations"
    };
  }

  // Get activity scopes for a satellite (returns list)
  rpc GetActivityScopes(GetActivityScopeRequest) returns (GetActivityScopesResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/provider/{provider}/satellites/{satelliteId}/activityscopes"
    };
  }

  // Get available contacts (visibility windows) from a provider
  rpc GetProviderContacts(GetContactsRequest) returns (GetContactsResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/provider/{provider}/contacts"
    };
  }

  // Reserve a contact with a provider
  rpc ReserveContact(ReserveContactRequest) returns (ProviderBookingInfo) {
    option (yamcs.api.route) = {
      post: "/api/booking/provider/{provider}/reserve"
      body: "*"
    };
  }

  // Cancel a provider booking
  rpc CancelProviderBooking(CancelBookingRequest) returns (CancelBookingResponse) {
    option (yamcs.api.route) = {
      post: "/api/booking/provider/{provider}/cancel"
      body: "*"
    };
  }

  // Get provider bookings
  rpc GetProviderBookings(GetProviderDataRequest) returns (GetProviderBookingsResponse) {
    option (yamcs.api.route) = {
      get: "/api/booking/provider/{provider}/bookings"
    };
  }
}

// Messages
message GetProvidersResponse {
  repeated ProviderInfo providers = 1;
}

message GetBookingsResponse {
  repeated BookingInfo bookings = 1;
}

message ProviderInfo {
  optional int32 id = 1;
  optional string name = 2;
  optional string type = 3;
  optional string contactEmail = 4;
  optional string contactPhone = 5;
  optional string apiEndpoint = 6;
  optional bool isActive = 7;
  optional google.protobuf.Timestamp createdAt = 8;
  optional google.protobuf.Timestamp updatedAt = 9;
}

message BookingInfo {
  optional int32 id = 1;
  optional string provider = 2;
  optional string satelliteId = 3;
  optional google.protobuf.Timestamp startTime = 4;
  optional google.protobuf.Timestamp endTime = 5;
  optional int32 durationMinutes = 6;
  optional string passType = 7;
  optional string purpose = 8;
  optional string ruleType = 9;
  optional int32 frequencyDays = 10;
  optional string status = 11;
  optional string gsStatus = 12;
  optional string requestedBy = 13;
  optional string approvedBy = 14;
  optional google.protobuf.Timestamp approvedAt = 15;
  optional string rejectionReason = 16;
  optional string notes = 17;
  optional google.protobuf.Timestamp createdAt = 18;
  optional google.protobuf.Timestamp updatedAt = 19;
  // Provider-specific fields
  optional string providerBookingId = 20;
  optional string providerSatelliteId = 21;
  optional double maxElevation = 22;
}

message CreateBookingRequest {
  optional string provider = 1;
  optional string satelliteId = 2;
  optional google.protobuf.Timestamp startTime = 3;
  optional int32 durationMinutes = 4;
  optional string passType = 5;
  optional string purpose = 6;
  optional string ruleType = 7;
  optional int32 frequencyDays = 8;
  optional string notes = 9;
}

message ApprovalRequest {
  optional int32 id = 1;
  optional string comments = 2;
}

message GetEnumValuesResponse {
  repeated string providerTypes = 1;
  repeated string ruleTypes = 2;
  repeated string statusTypes = 3;
  repeated string passTypes = 4;
  repeated string purposeTypes = 5;
  repeated string gsStatusTypes = 6;
}

// Provider API messages
message GetProviderDataRequest {
  optional string provider = 1;
}

message GetActivityScopeRequest {
  optional string provider = 1;
  optional string satelliteId = 2;
}

message GetContactsRequest {
  optional string provider = 1;
  optional string gsId = 2;
  optional string satelliteId = 3;
  optional string spbasId = 4;
  optional string startDate = 5;  // YYYY-MM-DD format
  optional string endDate = 6;    // YYYY-MM-DD format
}

message ReserveContactRequest {
  optional string provider = 1;
  optional string gsId = 2;
  optional string satelliteId = 3;
  optional string gsVisibilityId = 4;
  optional string gsabracId = 5;
  optional string purpose = 6;
  optional string notes = 7;
  optional string satelliteName = 8;  // Human-readable satellite name
}

message CancelBookingRequest {
  optional string provider = 1;
  optional string satellitePassBookingId = 2;
}

message CancelBookingResponse {
  optional bool success = 1;
  optional string message = 2;
}

// Satellite info from provider
message SatelliteInfo {
  optional string id = 1;
  optional string name = 2;
  optional string noradId = 3;
}

message GetSatellitesResponse {
  repeated SatelliteInfo satellites = 1;
}

// Ground station info from provider
message GroundStationInfo {
  optional string id = 1;
  optional string name = 2;
  optional string city = 3;
  optional string state = 4;
  optional string country = 5;
  optional double latitude = 6;
  optional double longitude = 7;
}

message GetGroundStationsResponse {
  repeated GroundStationInfo groundStations = 1;
}

// Activity scope info
message ActivityScopeInfo {
  optional string gsabracId = 1;
  optional string spbasId = 2;
  optional string satelliteId = 3;
  optional string activityScope = 4;
  optional string taskName = 5;
  optional string communicationBand = 6;
}

message GetActivityScopesResponse {
  repeated ActivityScopeInfo activityScopes = 1;
}

// Contact/visibility window info
message ContactInfo {
  optional string gsVisibilityId = 1;
  optional string gsId = 2;
  optional string groundStationName = 3;
  optional string satelliteId = 4;
  optional google.protobuf.Timestamp passStart = 5;
  optional google.protobuf.Timestamp passEnd = 6;
  optional double maxElevation = 7;
  optional string status = 8;
  optional int32 durationSeconds = 9;
}

message GetContactsResponse {
  repeated ContactInfo contacts = 1;
}

// Provider booking info
message ProviderBookingInfo {
  optional string satellitePassBookingId = 1;
  optional string gsId = 2;
  optional string groundStationName = 3;
  optional string gsVisibilityId = 4;
  optional int32 noradId = 5;
  optional google.protobuf.Timestamp startDateTime = 6;
  optional google.protobuf.Timestamp endDateTime = 7;
  optional string status = 8;
  optional double maxElevation = 9;
}

message GetProviderBookingsResponse {
  repeated ProviderBookingInfo bookings = 1;
}